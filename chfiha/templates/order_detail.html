{% extends 'base.html' %}


{% block content %}

<!-- Main Content -->
<main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <!-- Order Header -->
    <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
        <h1 class="text-2xl font-bold mb-4">Order #{{ project.id }}</h1>
        <p class="text-gray-700 mb-4">Service: {{ project.service.title }}</p>
        <p class="text-gray-700">Deadline: <span class="text-red-500">{{ project.end_date }}</span></p>
    </div>

    <!-- Delivery Steps -->
    <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
        <h2 class="text-xl font-semibold mb-4">Delivery Steps</h2>
        <ul class="space-y-4">
            <li class="flex items-center space-x-4">
                <i class="fas fa-check-circle {% if project.step1_status == 'D' %}text-green-500{% else %}text-gray-500{% endif %}"></i>
                <span>Step 1: Initial Design - {{ project.get_step1_status_display }}</span>
                {% if project.step1_file %}
                    <a href="{{ project.step1_file.url }}" download class="ml-4 text-blue-600 hover:underline">Download File</a>
                {% endif %}
            </li>
            <li class="flex items-center space-x-4">
                <i class="fas fa-check-circle {% if project.step2_status == 'D' %}text-green-500{% else %}text-gray-500{% endif %}"></i>
                <span>Step 2: Content Integration - {{ project.get_step2_status_display }}</span>
                {% if project.step2_file %}
                    <a href="{{ project.step2_file.url }}" download class="ml-4 text-blue-600 hover:underline">Download File</a>
                {% endif %}
            </li>
            <li class="flex items-center space-x-4">
                <i class="fas fa-check-circle {% if project.step3_status == 'D' %}text-green-500{% else %}text-gray-500{% endif %}"></i>
                <span>Step 3: SEO Optimization - {{ project.get_step3_status_display }}</span>
                {% if project.step3_file %}
                    <a href="{{ project.step3_file.url }}" download class="ml-4 text-blue-600 hover:underline">Download File</a>
                {% endif %}
            </li>
            <li class="flex items-center space-x-4">
                <i class="fas fa-check-circle {% if project.step4_status == 'D' %}text-green-500{% else %}text-gray-500{% endif %}"></i>
                <span>Step 4: E-commerce Setup - {{ project.get_step4_status_display }}</span>
                {% if project.step4_file %}
                    <a href="{{ project.step4_file.url }}" download class="ml-4 text-blue-600 hover:underline">Download File</a>
                {% endif %}
            </li>
            <li class="flex items-center space-x-4">
                <i class="fas fa-check-circle {% if project.step5_status == 'D' %}text-green-500{% else %}text-gray-500{% endif %}"></i>
                <span>Step 5: Final Review - {{ project.get_step5_status_display }}</span>
                {% if project.step5_file %}
                    <a href="{{ project.step5_file.url }}" download class="ml-4 text-blue-600 hover:underline">Download File</a>
                {% endif %}
            </li>
        </ul>
    </div>

        <!-- Messaging Section -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <h2 class="text-xl font-semibold mb-4">To: 
              {% if project.client.user == request.user %}
                {{ project.freelancer.user.first_name }} {{ project.freelancer.user.last_name }}
              {% else %}
                {{ project.client.user.first_name }} {{ project.client.user.last_name }}
              {% endif %}
            </h2>
            <div class="flex flex-col space-y-4 max-h-96 overflow-y-auto">
            {% for message in order_messages %}
              {% if message.sender == request.user.profile %}

                    {% if message.text %}
                    <!-- Example message from receiver -->
                    <div class="flex justify-end">
                        <div class="bg-blue-500 p-4 rounded-lg max-w-md text-white">
                            <p>{{ message.text }}</p>
                        </div>
                    </div>
                    {% endif %}
                    {% if message.file %}
                    <!-- Attachment preview receiver -->
                    <div class="flex justify-end">
                        <div class="bg-gray-100 p-4 rounded-lg max-w-md">
                          <a href="{{ message.file.url }}" class="text-blue-500 hover:underline break-words">{{ message.file.name }}</a>
                        </div>
                    </div>
                    {% endif %}

              {% else %}

                    {% if message.text %}
                    <!-- Example message from sender -->
                    <div class="flex justify-start">
                        <div class="bg-gray-200 p-4 rounded-lg max-w-md">
                            <p class="text-gray-900">{{ message.text }}</p>
                        </div>
                    </div>
                    {% endif %}
                    {% if message.file %}
                    <!-- Attachment preview sender -->
                    <div class="flex justify-start">
                        <div class="bg-gray-100 p-4 rounded-lg max-w-md">
                            <a href="{{ message.file.url }}" class="text-blue-500 hover:underline break-words">{{ message.file.name }}</a>
                        </div>
                    </div>
                    {% endif %}

              {% endif %}

            {% empty %}

                <div class="flex justify-start">
                    <div class="p-4 rounded-lg max-w-md">
                        <p class="text-gray-900">No Messages</p>
                    </div>
                </div>

            {% endfor %}

            </div>
            <!-- Message input area -->

    <form method="post" enctype="multipart/form-data" class="flex items-center mt-4">
        {% csrf_token %}
        {{ message_form.text }}
        <div class="relative">
            {{ message_form.file }}
            <label for="file-upload" class="cursor-pointer text-gray-600 hover:text-gray-800">
                <i class="fas fa-paperclip fa-lg"></i>
            </label>
        </div>
        <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded-lg shadow-lg ml-4">
            <i class="fas fa-paper-plane"></i>
        </button>
    </form>
</div>

        <!-- Related Service Section -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-4">
            <div class="bg-gradient-to-r from-blue-400 to-purple-500 text-white py-4 px-6 rounded-lg shadow-lg">
                <h3 class="text-2xl font-bold mb-2">{{ project.service.title }}</h3>
                <p class="text-white mb-4">{{ project.service.description }}</p>
                <a href="{% url 'service' pk=project.pk %}" class="bg-white text-blue-500 font-bold py-2 px-4 rounded-lg shadow-lg inline-block mb-2">View Service</a>
            </div>
        </div>
    </main>

{% endblock content %}
